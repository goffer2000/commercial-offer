<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Форма коммерческого предложения</title>
  <style>
    body { font-family: sans-serif; margin: 40px; }
    label { display: block; margin-top: 10px; }
    input, select {
      padding: 6px; margin-top: 4px; width: 300px; box-sizing: border-box;
    }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h2>Форма коммерческого предложения</h2>
  <form method="post">
    <label>Адрес объекта: <input name="address" required></label>
    <label>Наименование объекта: <input name="object_name" required></label>
    <label>Дата: <input type="date" name="date" value="{{ current_date }}" required></label>
    <label>Площадь покрытия (м²): <input name="area" id="area" type="number" step="0.1" required></label>
    <label>Материал:
      <select name="material" id="material" required>
        <option value="">-- Выберите --</option>
        <option value="PERLATA">PERLATA</option>
        <option value="TACTITE">TACTITE</option>
        <option value="LimeWash">LimeWash</option>
        <option value="ISTRIA">ISTRIA P350</option>
      </select>
    </label>
    <label>Количество основного материала (л):
      <input name="material_qty" id="material_qty" type="number" step="1" required>
    </label>
    <label>Стоимость (тг): <input name="material_cost" id="material_cost" type="number" step="1" required></label>
    <div id="baseLayerGroup" class="hidden">
      <label>Базовый слой: <select name="base_layer" id="base_layer"></select></label>
      <label>Количество (л): <input name="base_qty" id="base_qty" type="number" step="1"></label>
      <label>Стоимость (тг): <input name="base_cost" id="base_cost" type="number" step="1"></label>
    </div>
    <div id="aquawaxGroup" class="hidden">
      <p><strong>AQUAWAX:</strong></p>
      <label>Количество (л): <input name="aquawax_qty" id="aquawax_qty" type="number" step="1"></label>
      <label>Стоимость (тг): <input name="aquawax_cost" id="aquawax_cost" type="number" step="1"></label>
    </div>
    <br><button type="submit">Сформировать PDF</button>
  </form>
  <script>
    const materialSelect = document.getElementById("material");
    const materialQty = document.getElementById("material_qty");
    const materialCost = document.getElementById("material_cost");
    const aquawaxQty = document.getElementById("aquawax_qty");
    const aquawaxCost = document.getElementById("aquawax_cost");

    const PRICES = {
      PERLATA: 54200, TACTITE: 72000, LimeWash: 28000, ISTRIA: 10563,
      AQUAWAX: 59000,
      base_27000: ["BaseColor Matt", "BaseColor Satine"],
      base_8000: ["Dulux Bindo20"],
      base_4000: ["Marshall Export2"]
    };

    function setupSync(qtyField, costField, price) {
      qtyField?.addEventListener("input", () => {
        const qty = parseFloat(qtyField.value) || 0;
        costField.value = Math.round(qty * price);
      });
      costField?.addEventListener("input", () => {
        const cost = parseFloat(costField.value) || 0;
        qtyField.value = Math.ceil(cost / price);
      });
    }

    materialSelect.addEventListener("change", () => {
      const material = materialSelect.value;
      setupSync(materialQty, materialCost, PRICES[material]);
      if (["LimeWash", "ISTRIA"].includes(material)) {
        document.getElementById("aquawaxGroup").classList.remove("hidden");
        setupSync(aquawaxQty, aquawaxCost, PRICES.AQUAWAX);
      } else {
        document.getElementById("aquawaxGroup").classList.add("hidden");
        aquawaxQty.value = "";
        aquawaxCost.value = "";
      }
    });
  </script>
</body>
</html>
